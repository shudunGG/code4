"use strict";(self["webpackChunkxsecmcx"]=self["webpackChunkxsecmcx"]||[]).push([[475],{2475:function(e,t,a){a.r(t),a.d(t,{default:function(){return y}});var n=function(){var e=this,t=e._self._c;return t("div",[t("section",{staticClass:"query-container"},[t("el-form",{ref:"formData",attrs:{action:"",model:e.formData,rules:e.formRules,"label-position":"right","label-width":"120px"}},[t("el-form-item",{attrs:{label:"统计年份"}},[t("el-date-picker",{staticClass:"slt",attrs:{clearable:!1,format:"yyyy","value-format":"yyyy",type:"year","prefix-icon":"el-icon-document",placeholder:"请选择统计年份"},model:{value:e.formData.nianfen,callback:function(t){e.$set(e.formData,"nianfen",t)},expression:"formData.nianfen"}})],1),t("div",{staticClass:"verification-code"},[t("el-form-item",{attrs:{label:"验证码",prop:"code"}},[t("el-input",{staticClass:"yanzhengma",attrs:{placeholder:"请输入验证码","prefix-icon":"el-icon-edit",maxlength:"4",onkeyup:"value=value.replace(/[\\u4e00-\\u9fa5]/ig,'')"},on:{input:e.inputKeyUp},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.queryList("formData")}},model:{value:e.formData.code,callback:function(t){e.$set(e.formData,"code",t)},expression:"formData.code"}})],1),t("div",{staticClass:"code",on:{click:e.updateCode}},[t("canvas",{attrs:{id:"canvas",width:"100",height:"38"}})])],1),t("div",{staticClass:"form-btn"},[t("input",{staticClass:"submit",attrs:{type:"button",value:"查询"},on:{click:function(t){return e.queryList("formData")}}}),t("input",{attrs:{type:"reset",value:"重置"},on:{click:function(t){return e.resetForm("formData")}}})])],1)],1),t("router-view",{key:e.key})],1)},r=[];let s="";function o(){let e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),a=Math.floor(256*Math.random());return"rgb("+e+","+t+","+a+")"}function i(e){let t=[],a=document.getElementById("canvas").width,n=document.getElementById("canvas").height,r=document.getElementById("canvas"),i=r.getContext("2d");r.width=a,r.height=n;let c=e,d=c.split(",");for(let s=0;s<1;s++){let e=15*Math.random()*Math.PI/180,a=d[s];t[s]=a?.toLowerCase();let n=10+13*s,r=20+3*Math.random();i.font="bold 20px 微软雅黑",i.translate(n,r),i.rotate(e),i.fillStyle=o(),i.fillText(a,0,0),i.rotate(-e),i.translate(-n,-r)}for(let s=0;s<=5;s++)i.strokeStyle=o(),i.beginPath(),i.moveTo(Math.random()*a,Math.random()*n),i.lineTo(Math.random()*a,Math.random()*n),i.stroke();for(let s=0;s<=30;s++){i.strokeStyle=o(),i.beginPath();let e=Math.random()*a,t=Math.random()*n;i.moveTo(e,t),i.lineTo(e+1,t+1),i.stroke()}s=t.join("")}var c=a(6265),d=a.n(c);const p="https://zwfw.gansu.gov.cn/jpaas-jags-server/interface/",h={createSignJpaas:function(e={}){return new Promise(((t,a)=>{d()({method:"post",url:`${p}createsign`,data:e}).then((function(e){if(e.data.success){const{sign:a}=e.data.data;t(a)}else a(e)})).catch((function(e){a(e)}))}))},getDataFromJpaas:function(e={}){return new Promise(((t,a)=>{d()({method:"post",url:`${p}gateway`,data:e}).then((function(e){if(200==e.data.code&&1==e.data.success){const n=JSON.parse(e.data.data);if(200==n.code)t(n);else{const t=JSON.parse(JSON.parse(e.data.data).data);a(t)}}else a(e)})).catch((function(e){a(e)}))}))},getData:function({columnId:e="",params:t={}}={}){const a=new URLSearchParams;return a.append("header","{}"),a.append("version","1.0"),a.append("charset","UTF-8"),a.append("origin","1"),a.append("timestamp",(new Date).getTime()),a.append("interface_id","showVerifyCode"),a.append("app_id","yzm"),a.append("biz_content",JSON.stringify(Object.assign({}))),new Promise(((e,t)=>{h.createSignJpaas(a).then((e=>(a.append("sign",e),h.getDataFromJpaas(a)))).then((t=>{try{var a=JSON.parse(t);e("object"===typeof a&&a?JSON.parse(t):t)}catch(n){e(t)}})).catch((e=>{t(e)}))}))}},l={createSignJpaas:function(e={}){return new Promise(((t,a)=>{d()({method:"post",url:`${p}createsign`,data:e}).then((function(e){if(e.data.success){const{sign:a}=e.data.data;t(a)}else a(e)})).catch((function(e){a(e)}))}))},getDataFromJpaas:function(e={}){return new Promise(((t,a)=>{d()({method:"post",url:`${p}gateway`,data:e}).then((function(e){const a=JSON.parse(e.data.data);t(a)})).catch((function(e){a(e)}))}))},getData:function(e){const t=new URLSearchParams;return t.append("header","{}"),t.append("version","1.0"),t.append("charset","UTF-8"),t.append("origin","1"),t.append("timestamp",(new Date).getTime()),t.append("interface_id","cheackCaptcha"),t.append("app_id","yzm"),t.append("biz_content",JSON.stringify(Object.assign(e))),new Promise(((e,a)=>{l.createSignJpaas(t).then((e=>(t.append("sign",e),l.getDataFromJpaas(t)))).then((t=>{try{var a=JSON.parse(t);e("object"===typeof a&&a?JSON.parse(t):t)}catch(n){e(t)}})).catch((e=>{a(e)}))}))}};var u={name:"IndexView",created(){this.$router.push({name:"Results",params:{res:JSON.stringify(this.formData)}})},async mounted(){await this.queryCode(),this.$nextTick((()=>{i(this.captcha.sandCode)}))},data(){const e=async(e,t,a)=>{if(await this.verifyCode(),!this.codeFlag)return this.formData.code="",a(new Error("验证码错误"));a()},t=(e,t,a)=>{this.checkSpecialKeyCode(t)?t.includes(" ")?a(new Error("不能含有特殊字符")):a():a(new Error("不能含有特殊字符"))};let a=(e,t,a)=>{this.checkSpecialKey(t)?t.includes(" ")?a(new Error("不能含有特殊字符")):a():a(new Error("不能含有特殊字符"))};return{key:0,isOpenResult:!1,formData:{nianfen:"",name:"",code:"",selectName:"",selectArr:[]},cityArr:[],show:!0,phone:"",code:"",formRules:{code:[{required:!0,message:"验证码不能为空",trigger:"blur"},{min:4,max:4,message:"验证码长度为4个字符",trigger:"blur"},{validator:t,trigger:"blur"},{validator:e,trigger:"click"}],nianfen:[{validator:a,trigger:"blur"}]},value:"",captcha:{uuid:"",sandCode:""},codeFlag:!1}},methods:{checkSpecialKey(e){let t="/[`-~!@#$^&*=|{}':;',\\\\\\[\\]\\.<>\\/?~！@#￥……&%*（）——|{}【】'；：\"\"'。，、？\\]/";for(let a=0;a<e.length;a++)if(-1!=t.indexOf(e.substr(a,1)))return!1;return!0},checkSpecialKeyCode(e){let t="/[`-~!@#$^&*=|{}':;',\\\\\\[\\]\\.<>\\/?~！@#￥……&%*（）——|{}【】'；：\"\"'。，、？\\]/";for(let a=0;a<e.length;a++)if(-1!=t.indexOf(e.substr(a,1)))return!1;return!0},async queryList(e){this.$refs[e].validate((async e=>{if(await this.updateCode(),this.formData.code="",!e)return!1;this.formData.nianfen=this.formData.nianfen.replace(/\s+/g,""),this.$router.push({name:"Index"}),this.formData,this.$router.push({name:"Results",params:{res:JSON.stringify(this.formData)}})}))},resetForm(e){this.updateCode(),this.$refs[e].resetFields(),this.formData.selectName="",this.formData.nianfen="",this.$router.push({name:"Index"}),this.$router.push({name:"Results",params:{res:JSON.stringify(this.formData),flage:"resetForm"}})},async queryCode(){const e=await h.getData().catch((e=>{}));e&&("200"===e.code?(this.captcha.uuid=e.data.captcha.uuid,this.captcha.sandCode=e.data.captcha.capStr):this.$message({type:"error",message:"验证码获取失败，请重试或联系管理员"}))},async updateCode(){this.captcha.uuid="",this.captcha.sandCode="",await this.queryCode(),i(this.captcha.sandCode)},async verifyCode(){try{let e=new FormData;e.append("uuid",this.captcha.uuid),e.append("sandCode",this.formData.code),this.captcha.sandCode=this.formData.code;const t=await l.getData(this.captcha);"200"==t.code?this.codeFlag=!0:this.codeFlag=!1}catch(e){this.$message({type:"error",message:"验证码校验失败，请重试或联系管理员"})}},keyUp(e){const t=/[`~!@#$^&*()=|{}':;',\\\[\]\.<>\/?~！@#￥……&%*（）——|{}【】'；：""'。，、？\s]/g;this.formData[e]=this.formData[e].replace(t,"")},inputKeyUp(){const e=/[`~!@#$^&*()=|{}':;',\\\[\]\.<>\/?~！@#￥……&%*（）——|{}【】'；：""'。，、？\s]/g;this.formData.code=this.formData.code.replace(e,"")}}},m=u,f=a(1001),g=(0,f.Z)(m,n,r,!1,null,"43250ec0",null),y=g.exports}}]);