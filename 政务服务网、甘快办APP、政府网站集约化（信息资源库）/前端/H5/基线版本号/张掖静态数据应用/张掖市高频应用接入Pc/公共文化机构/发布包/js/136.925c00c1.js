"use strict";(self["webpackChunkxsecmcx"]=self["webpackChunkxsecmcx"]||[]).push([[136],{9136:function(t,e,a){a.r(e),a.d(e,{default:function(){return w}});var n=function(){var t=this,e=t._self._c;return e("div",[e("section",{staticClass:"query-container"},[e("el-form",{ref:"formData",attrs:{action:"",model:t.formData,rules:t.formRules,"label-position":"right","label-width":"80px"}},[e("el-form-item",{attrs:{label:"名称",prop:"name"}},[e("el-input",{staticClass:"slt",attrs:{placeholder:"单位名称","prefix-icon":"el-icon-document"},on:{input:t.keyUp},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name","string"===typeof e?e.trim():e)},expression:"formData.name"}})],1),e("div",{staticClass:"verification-code"},[e("el-form-item",{attrs:{label:"验证码",prop:"code"}},[e("el-input",{staticClass:"yanzhengma",attrs:{placeholder:"请输入验证码","prefix-icon":"el-icon-edit",maxlength:"4",onkeyup:"value=value.replace(/[\\u4e00-\\u9fa5]/ig,'')"},on:{input:t.inputKeyUp},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.queryList("formData")}},model:{value:t.formData.code,callback:function(e){t.$set(t.formData,"code","string"===typeof e?e.trim():e)},expression:"formData.code"}})],1),e("div",{staticClass:"code",on:{click:t.updateCode}},[e("canvas",{attrs:{id:"canvas",width:"100",height:"38"}})])],1),e("div",{staticClass:"form-btn"},[e("input",{staticClass:"submit",attrs:{type:"button",value:"查询"},on:{click:function(e){return t.queryList("formData")}}}),e("input",{attrs:{type:"reset"},on:{click:function(e){return t.resetForm("formData")}}})])],1)],1),e("router-view",{key:t.key})],1)},s=[],r=a(6265),o=a.n(r);const i=t=>{const e=new URLSearchParams;return e.append("app_id","sx"),e.append("interface_id","qhwjld"),e.append("version","1.0"),e.append("biz_content",JSON.stringify({areaCode:t||""})),e.append("charset","UTF-8"),e.append("origin","0"),e.append("timestamp",(new Date).valueOf()),new Promise(((t,a)=>{o()({method:"post",url:"https://zwfw.gansu.gov.cn/jpaas-jags-server/interface/createsign.do",data:e}).then((n=>{e.append("sign",n.data.data.sign),o()({method:"post",url:"https://zwfw.gansu.gov.cn/jpaas-jags-server/interface/gateway.do",data:e}).then((e=>{t(JSON.parse(e.data.data))})).catch((t=>{a(t)}))})).catch((t=>{a(t)}))}))};let c="";function d(){let t=Math.floor(256*Math.random()),e=Math.floor(256*Math.random()),a=Math.floor(256*Math.random());return"rgb("+t+","+e+","+a+")"}function p(t){let e=[],a=document.getElementById("canvas").width,n=document.getElementById("canvas").height,s=document.getElementById("canvas"),r=s.getContext("2d");s.width=a,s.height=n;let o=t,i=o.split(",");for(let c=0;c<1;c++){let t=15*Math.random()*Math.PI/180,a=i[c];e[c]=a?.toLowerCase();let n=10+13*c,s=20+3*Math.random();r.font="bold 20px 微软雅黑",r.translate(n,s),r.rotate(t),r.fillStyle=d(),r.fillText(a,0,0),r.rotate(-t),r.translate(-n,-s)}for(let c=0;c<=5;c++)r.strokeStyle=d(),r.beginPath(),r.moveTo(Math.random()*a,Math.random()*n),r.lineTo(Math.random()*a,Math.random()*n),r.stroke();for(let c=0;c<=30;c++){r.strokeStyle=d(),r.beginPath();let t=Math.random()*a,e=Math.random()*n;r.moveTo(t,e),r.lineTo(t+1,e+1),r.stroke()}c=e.join("")}const h="https://zwfw.gansu.gov.cn/jpaas-jags-server/interface/",m={createSignJpaas:function(t={}){return new Promise(((e,a)=>{o()({method:"post",url:`${h}createsign`,data:t}).then((function(t){if(t.data.success){const{sign:a}=t.data.data;e(a)}else a(t)})).catch((function(t){a(t)}))}))},getDataFromJpaas:function(t={}){return new Promise(((e,a)=>{o()({method:"post",url:`${h}gateway`,data:t}).then((function(t){if(200==t.data.code&&1==t.data.success){const n=JSON.parse(t.data.data);if(200==n.code)e(n);else{const e=JSON.parse(JSON.parse(t.data.data).data);a(e)}}else a(t)})).catch((function(t){a(t)}))}))},getData:function({columnId:t="",params:e={}}={}){const a=new URLSearchParams;return a.append("header","{}"),a.append("version","1.0"),a.append("charset","UTF-8"),a.append("origin","1"),a.append("timestamp",(new Date).getTime()),a.append("interface_id","showVerifyCode"),a.append("app_id","yzm"),a.append("biz_content",JSON.stringify(Object.assign({}))),new Promise(((t,e)=>{m.createSignJpaas(a).then((t=>(a.append("sign",t),m.getDataFromJpaas(a)))).then((e=>{try{var a=JSON.parse(e);t("object"===typeof a&&a?JSON.parse(e):e)}catch(n){t(e)}})).catch((t=>{e(t)}))}))}},u={createSignJpaas:function(t={}){return new Promise(((e,a)=>{o()({method:"post",url:`${h}createsign`,data:t}).then((function(t){if(t.data.success){const{sign:a}=t.data.data;e(a)}else a(t)})).catch((function(t){a(t)}))}))},getDataFromJpaas:function(t={}){return new Promise(((e,a)=>{o()({method:"post",url:`${h}gateway`,data:t}).then((function(t){const a=JSON.parse(t.data.data);e(a)})).catch((function(t){a(t)}))}))},getData:function(t){const e=new URLSearchParams;return e.append("header","{}"),e.append("version","1.0"),e.append("charset","UTF-8"),e.append("origin","1"),e.append("timestamp",(new Date).getTime()),e.append("interface_id","cheackCaptcha"),e.append("app_id","yzm"),e.append("biz_content",JSON.stringify(Object.assign(t))),new Promise(((t,a)=>{u.createSignJpaas(e).then((t=>(e.append("sign",t),u.getDataFromJpaas(e)))).then((e=>{try{var a=JSON.parse(e);t("object"===typeof a&&a?JSON.parse(e):e)}catch(n){t(e)}})).catch((t=>{a(t)}))}))}};var l={name:"IndexView",created(){i().then((t=>{t.data,this.formData.selectArr=this.cityArr.concat(t.data),this.formData.selectArr.unshift(this.formData.selectArr[15]),this.formData.selectArr.splice(16,17),this.formData.selectArr.splice(1,2)})),this.$router.push({name:"Results",params:{res:this.formData}})},async mounted(){await this.queryCode(),this.$nextTick((()=>{p(this.captcha.sandCode)}))},data(){const t=async(t,e,a)=>{if(await this.verifyCode(),!this.codeFlag)return this.formData.code="",a(new Error("验证码错误"));a()};return{key:0,isOpenResult:!1,formData:{name:"",code:"",selectName:"",selectArr:[]},cityArr:[],show:!0,phone:"",code:"",formRules:{code:[{required:!0,message:"验证码不能为空",trigger:"blur"},{min:4,max:4,message:"验证码长度为4个字符",trigger:"blur"},{validator:t,trigger:"click"}]},value:"",captcha:{uuid:"",sandCode:""},codeFlag:!1}},methods:{async queryList(t){this.$refs[t].validate((async t=>{if(await this.updateCode(),this.formData.code="",!t)return!1;this.$router.push({name:"Index"}),this.$router.push({name:"Results",params:{res:this.formData,flage:"resetForm"}})}))},async resetForm(t){await this.updateCode(),this.$refs[t].resetFields(),this.formData.selectName="",this.formData.name="",this.$router.push({name:"Index"}),this.$router.push({name:"Results",params:{res:this.formData,flage:"resetForm"}})},async queryCode(){const t=await m.getData();"200"===t.code?(this.captcha.uuid=t.data.captcha.uuid,this.captcha.sandCode=t.data.captcha.capStr):this.$message({type:"error",message:"验证码获取失败，请重试或联系管理员"})},async updateCode(){this.captcha.uuid="",this.captcha.sandCode="",await this.queryCode(),p(this.captcha.sandCode)},async verifyCode(){try{let t=new FormData;t.append("uuid",this.captcha.uuid),t.append("sandCode",this.formData.code),this.captcha.sandCode=this.formData.code;const e=await u.getData(this.captcha);"200"==e.code?this.codeFlag=!0:this.codeFlag=!1}catch(t){this.$message({type:"error",message:"验证码校验失败，请重试或联系管理员"})}},keyUp(){const t=/[`~!@#$^&*()=|{}':;',\\\[\]\.<>\/?~！@#￥……&%*（）——|{}【】'；：""'。，、？\s]/g;this.formData.name=this.formData.name.replace(t,"")},inputKeyUp(){const t=/[`~!@#$^&*()=|{}':;',\\\[\]\.<>\/?~！@#￥……&%*（）——|{}【】'；：""'。，、？\s]/g;this.formData.code=this.formData.code.replace(t,"")}}},f=l,g=a(1001),y=(0,g.Z)(f,n,s,!1,null,"9613e10c",null),w=y.exports}}]);