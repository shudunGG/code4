"use strict";(self["webpackChunkxsecmcx"]=self["webpackChunkxsecmcx"]||[]).push([[557],{6557:function(t,a,e){e.r(a),e.d(a,{default:function(){return w}});var n=function(){var t=this,a=t._self._c;return a("div",[a("section",{staticClass:"query-container"},[a("el-form",{ref:"formData",attrs:{action:"",model:t.formData,rules:t.formRules,"label-position":"right","label-width":"80px"}},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{staticClass:"slt",attrs:{placeholder:"收费站名称","prefix-icon":"el-icon-document"},on:{input:t.keyUp},model:{value:t.formData.name,callback:function(a){t.$set(t.formData,"name","string"===typeof a?a.trim():a)},expression:"formData.name"}})],1),a("div",{staticClass:"verification-code"},[a("el-form-item",{attrs:{label:"验证码",prop:"code"}},[a("el-input",{staticClass:"yanzhengma",attrs:{placeholder:"请输入验证码","prefix-icon":"el-icon-edit",maxlength:"4",onkeyup:"value=value.replace(/[\\u4e00-\\u9fa5]/ig,'')"},on:{input:t.inputKeyUp},nativeOn:{keyup:function(a){return!a.type.indexOf("key")&&t._k(a.keyCode,"enter",13,a.key,"Enter")?null:t.queryList("formData")}},model:{value:t.formData.code,callback:function(a){t.$set(t.formData,"code","string"===typeof a?a.trim():a)},expression:"formData.code"}})],1),a("div",{staticClass:"code",on:{click:t.updateCode}},[a("canvas",{attrs:{id:"canvas",width:"100",height:"38"}})])],1),a("div",{staticClass:"form-btn"},[a("input",{staticClass:"submit",attrs:{type:"button",value:"查询"},on:{click:function(a){return t.queryList("formData")}}}),a("input",{attrs:{type:"reset"},on:{click:function(a){return t.resetForm("formData")}}})])],1)],1),a("router-view",{key:t.key})],1)},s=[],r=e(6265),o=e.n(r);const i=t=>{const a=new URLSearchParams;return a.append("app_id","sx"),a.append("interface_id","qhwjld"),a.append("version","1.0"),a.append("biz_content",JSON.stringify({areaCode:t||""})),a.append("charset","UTF-8"),a.append("origin","0"),a.append("timestamp",(new Date).valueOf()),new Promise(((t,e)=>{o()({method:"post",url:"https://zwfw.gansu.gov.cn/jpaas-jags-server/interface/createsign.do",data:a}).then((n=>{a.append("sign",n.data.data.sign),o()({method:"post",url:"https://zwfw.gansu.gov.cn/jpaas-jags-server/interface/gateway.do",data:a}).then((a=>{t(JSON.parse(a.data.data))})).catch((t=>{e(t)}))})).catch((t=>{e(t)}))}))};let c="";function d(){let t=Math.floor(256*Math.random()),a=Math.floor(256*Math.random()),e=Math.floor(256*Math.random());return"rgb("+t+","+a+","+e+")"}function p(t){let a=[],e=document.getElementById("canvas").width,n=document.getElementById("canvas").height,s=document.getElementById("canvas"),r=s.getContext("2d");s.width=e,s.height=n;let o=t,i=o.split(",");for(let c=0;c<1;c++){let t=15*Math.random()*Math.PI/180,e=i[c];a[c]=e?.toLowerCase();let n=10+13*c,s=20+3*Math.random();r.font="bold 20px 微软雅黑",r.translate(n,s),r.rotate(t),r.fillStyle=d(),r.fillText(e,0,0),r.rotate(-t),r.translate(-n,-s)}for(let c=0;c<=5;c++)r.strokeStyle=d(),r.beginPath(),r.moveTo(Math.random()*e,Math.random()*n),r.lineTo(Math.random()*e,Math.random()*n),r.stroke();for(let c=0;c<=30;c++){r.strokeStyle=d(),r.beginPath();let t=Math.random()*e,a=Math.random()*n;r.moveTo(t,a),r.lineTo(t+1,a+1),r.stroke()}c=a.join("")}const h="https://zwfw.gansu.gov.cn/jpaas-jags-server/interface/",m={createSignJpaas:function(t={}){return new Promise(((a,e)=>{o()({method:"post",url:`${h}createsign`,data:t}).then((function(t){if(t.data.success){const{sign:e}=t.data.data;a(e)}else e(t)})).catch((function(t){e(t)}))}))},getDataFromJpaas:function(t={}){return new Promise(((a,e)=>{o()({method:"post",url:`${h}gateway`,data:t}).then((function(t){if(200==t.data.code&&1==t.data.success){const n=JSON.parse(t.data.data);if(200==n.code)a(n);else{const a=JSON.parse(JSON.parse(t.data.data).data);e(a)}}else e(t)})).catch((function(t){e(t)}))}))},getData:function({columnId:t="",params:a={}}={}){const e=new URLSearchParams;return e.append("header","{}"),e.append("version","1.0"),e.append("charset","UTF-8"),e.append("origin","1"),e.append("timestamp",(new Date).getTime()),e.append("interface_id","showVerifyCode"),e.append("app_id","yzm"),e.append("biz_content",JSON.stringify(Object.assign({}))),new Promise(((t,a)=>{m.createSignJpaas(e).then((t=>(e.append("sign",t),m.getDataFromJpaas(e)))).then((a=>{try{var e=JSON.parse(a);t("object"===typeof e&&e?JSON.parse(a):a)}catch(n){t(a)}})).catch((t=>{a(t)}))}))}},u={createSignJpaas:function(t={}){return new Promise(((a,e)=>{o()({method:"post",url:`${h}createsign`,data:t}).then((function(t){if(t.data.success){const{sign:e}=t.data.data;a(e)}else e(t)})).catch((function(t){e(t)}))}))},getDataFromJpaas:function(t={}){return new Promise(((a,e)=>{o()({method:"post",url:`${h}gateway`,data:t}).then((function(t){const e=JSON.parse(t.data.data);a(e)})).catch((function(t){e(t)}))}))},getData:function(t){const a=new URLSearchParams;return a.append("header","{}"),a.append("version","1.0"),a.append("charset","UTF-8"),a.append("origin","1"),a.append("timestamp",(new Date).getTime()),a.append("interface_id","cheackCaptcha"),a.append("app_id","yzm"),a.append("biz_content",JSON.stringify(Object.assign(t))),new Promise(((t,e)=>{u.createSignJpaas(a).then((t=>(a.append("sign",t),u.getDataFromJpaas(a)))).then((a=>{try{var e=JSON.parse(a);t("object"===typeof e&&e?JSON.parse(a):a)}catch(n){t(a)}})).catch((t=>{e(t)}))}))}};var l={name:"IndexView",created(){i().then((t=>{t.data,this.formData.selectArr=this.cityArr.concat(t.data),this.formData.selectArr.unshift(this.formData.selectArr[15]),this.formData.selectArr.splice(16,17),this.formData.selectArr.splice(1,2)})),this.$router.push({name:"Results",params:{res:this.formData}})},async mounted(){await this.queryCode(),this.$nextTick((()=>{p(this.captcha.sandCode)}))},data(){const t=async(t,a,e)=>{if(await this.verifyCode(),!this.codeFlag)return this.formData.code="",e(new Error("验证码错误"));e()};return{key:0,isOpenResult:!1,formData:{name:"",code:"",selectName:"",selectArr:[]},cityArr:[],show:!0,phone:"",code:"",formRules:{code:[{required:!0,message:"验证码不能为空",trigger:"blur"},{min:4,max:4,message:"验证码长度为4个字符",trigger:"blur"},{validator:t,trigger:"click"}]},value:"",captcha:{uuid:"",sandCode:""},codeFlag:!1}},methods:{async queryList(t){this.$refs[t].validate((async t=>{if(await this.updateCode(),this.formData.code="",!t)return!1;this.$router.push({name:"Index"}),this.$router.push({name:"Results",params:{res:this.formData}})}))},async resetForm(t){await this.updateCode(),this.$refs[t].resetFields(),this.formData.selectName="",this.formData.name="",this.$router.push({name:"Index"}),this.$router.push({name:"Results",params:{res:this.formData,flage:"resetForm"}})},async queryCode(){const t=await m.getData();"200"===t.code?(this.captcha.uuid=t.data.captcha.uuid,this.captcha.sandCode=t.data.captcha.capStr):this.$message({type:"error",message:"验证码获取失败，请重试或联系管理员"})},async updateCode(){this.captcha.uuid="",this.captcha.sandCode="",await this.queryCode(),p(this.captcha.sandCode)},async verifyCode(){try{let t=new FormData;t.append("uuid",this.captcha.uuid),t.append("sandCode",this.formData.code),this.captcha.sandCode=this.formData.code;const a=await u.getData(this.captcha);"200"==a.code?this.codeFlag=!0:this.codeFlag=!1}catch(t){this.$message({type:"error",message:"验证码校验失败，请重试或联系管理员"})}},keyUp(){const t=/[`~!@#$^&*()=|{}':;',\\\[\]\.<>\/?~！@#￥……&%*（）——|{}【】'；：""'。，、？\s]/g;this.formData.name=this.formData.name.replace(t,"")},inputKeyUp(){const t=/[`~!@#$^&*()=|{}':;',\\\[\]\.<>\/?~！@#￥……&%*（）——|{}【】'；：""'。，、？\s]/g;this.formData.code=this.formData.code.replace(t,"")}}},f=l,g=e(1001),y=(0,g.Z)(f,n,s,!1,null,"5478cafc",null),w=y.exports}}]);